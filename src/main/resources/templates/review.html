<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>网签审核系统</title>
    <link rel="stylesheet" type="text/css" href="/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="/easyui/themes/color.css">
    <link rel="stylesheet" type="text/css" href="/easyui/demo/demo.css">
    <script type="text/javascript" src="/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="/easyui/jquery.easyui.min.js"></script>
    <link type="text/css" rel="stylesheet" charset="UTF-8" href="/easyui/locale/easyui-lang-zh_CN.js">
</head>

<body>
<table id="dg" title="审核列表" class="easyui-datagrid" style="width:100%;height:800px"
       toolbar="#toolbar"
       url="/web/getOrders"
       rownumbers="true"
       fitColumns="true"
       singleSelect="true"
       loadMsg="正在查询..."
       data-options="onClickCell:onClickCell">
    <thead>
    <tr>
        <th field="id" width="10%" >订单号</th>
        <th field="templateId" width="10%" >合同模板序号</th>
        <th field="supplierId" width="10%" data-options="editor:'text'">供货人序号</th>
        <th field="createTime" width="10%" data-options="editor:'text'">订单生成时间</th>
        <th field="itemName" width="10%" data-options="editor:'text'">货物名称</th>
        <th field="orderNum" width="10%" data-options="editor:'text'">业务编码</th>
        <th field="status" width="10%" >审核状态</th>
        <th field="updateTime" width="10%" data-options="editor:'text'">更新时间</th>
        <th field="path" width="20%" data-options="editor:'text'">订单合同路径</th>
    </tr>
    </thead>
</table>
<div id="toolbar">
    <a  href="#" class="easyui-linkbutton" iconCls="icon-ok" plain="true" onclick="pass()">审核通过</a>
    <a  href="#" class="easyui-linkbutton" iconCls="icon-no" plain="true" onclick="notpass()">审核不通过</a>
    <a  href="#" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" onclick="deleteOrder()">删除记录</a>
    <a  href="#" class="easyui-linkbutton" iconCls="icon-reload" plain="true" onclick="reload()">刷新记录</a>
    <a  href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="update()">提交修改</a>
</div>
</body>
<script type="text/javascript">
    //通过审核
    function pass() {
        var row = $('#dg').datagrid('getSelected');
        if (row){
            var id=row.id;
            $.ajax({
                url:"https://just.guohe3.cn/contract/passOrder",
                type:"post",
                data:{
                    id:id,
                },
                datatype:"josn",
                success:function(result){
                    $('#dg').datagrid('reload');
                }
            });
        }
    }

    //不通过审核
    function notpass() {
        var row = $('#dg').datagrid('getSelected');
        if (row){
            var id=row.id;
            $.ajax({
                url:"https://just.guohe3.cn/contract/notPassOrder",
                type:"post",
                data:{
                    id:id,
                },
                datatype:"josn",
                success:function(result){
                    $('#dg').datagrid('reload');
                }
            });
        }
    }

    //不通过审核
    function deleteOrder() {
        var row = $('#dg').datagrid('getSelected');
        if (row){
            var id=row.id;
            $.ajax({
                url:"https://just.guohe3.cn/contract/deleteOrder",
                type:"post",
                data:{
                    id:id,
                },
                datatype:"josn",
                success:function(result){
                    $('#dg').datagrid('reload');
                }
            });
        }
    }
    //刷新
    function reload() {
        $('#dg').datagrid('reload');
    }


</script>


<!--表格可编辑-->
<script type="text/javascript">
    $.extend($.fn.datagrid.methods, {
        editCell: function (jq, param) {
            return jq.each(function () {
                var opts = $(this).datagrid('options');
                var fields = $(this).datagrid('getColumnFields', true).concat($(this).datagrid('getColumnFields'));
                for (var i = 0; i < fields.length; i++) {
                    var col = $(this).datagrid('getColumnOption', fields[i]);
                    col.editor1 = col.editor;
                    if (fields[i] != param.field) {
                        col.editor = null;
                    }
                }
                $(this).datagrid('beginEdit', param.index);
                for (var i = 0; i < fields.length; i++) {
                    var col = $(this).datagrid('getColumnOption', fields[i]);
                    col.editor = col.editor1;
                }
            });
        }
    });

    var editIndex = undefined;
    function endEditing() {
        if (editIndex == undefined) { return true }
        if ($('#dg').datagrid('validateRow', editIndex)) {
            $('#dg').datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }
    function onClickCell(index, field) {
        if (endEditing()) {
            $('#dg').datagrid('selectRow', index)
                .datagrid('editCell', { index: index, field: field });
            editIndex = index;
        }
    }
</script>
</html>